Kafka��һ���ֲ�ʽ��Ϣϵͳ�����㷺Ӧ���ڻ������ʹ�����������ʵ��Ӧ���У�������Ҫʵ���ӳٶ��еĹ��ܣ��Ա���һ��ʱ���ִ��ĳЩ������߷���ĳЩ��Ϣ��Kafka�ṩ�˶��ַ�ʽ��ʵ���ӳٶ��У����Ľ���������һ�ֳ�����ʵ�ַ�����





### һ���ӳٶ��и���





�ӳٶ�����һ��������һ��ʱ���ִ�����������Ϣ�Ļ��ơ�������Ӧ�ó���������ʱ������Ϣ���͡�������ʱ�ȵȡ��ӳٶ��е�ʵ�ַ�ʽ�ж��֣�����һ�ֱȽϳ�����ʵ�ַ����ǻ�����Ϣ���е��ӳ���Ϣ���ơ�





��Kafka�У��ӳ���Ϣ��ָ�ڷ�����Ϣʱ��ָ��һ���ӳ�ʱ�䣬��Ϣ�����ӳ�ʱ�䵽���ű����������ѡ�Kafka�ṩ��һЩ�����Topic���ڴ洢�ӳ���Ϣ������"delayed-messages"�������߽��̿��Զ��ڴ���ЩTopic��������Ϣ��������Ϣ���·��͵�Ŀ��Topic�У��Ӷ�ʵ���ӳٶ��еĹ��ܡ�





### ����Kafka�е��ӳ���Ϣʵ��ԭ��





Kafka���ӳ���Ϣʵ��ԭ��Ƚϼ򵥣���Ҫ�漰����Ϣ��key��ʱ���������Ϣ��key�У���������һ��ʱ�������ʾ��Ϣ���ӳ�ʱ�䡣�������߷�����Ϣʱ������Ϣ���͵�"delayed-messages" Topic�У���������Ϣ��key�е�ʱ����������߽��̻ᶨ�ڴ�"delayed-messages" Topic��������Ϣ�������Ϣ��key�е�ʱ����Ƿ��Ѿ����ڡ����ʱ����Ѿ����ڣ�����Ϣ���·��͵�Ŀ��Topic�У�����"target-messages"�����ʱ�����δ���ڣ�����Ϣ���·��͵�"delayed-messages" Topic�У�������һ���µ��ӳ�ʱ������������Ϳ���ʵ���ӳٶ��еĹ��ܡ�




![image-20230526211424767](https://java-tutorial.oss-cn-shanghai.aliyuncs.com/image-20230526211424767.png)





### ����Kafka���ӳٶ��е�ʵ�ֲ���





ʵ��Kafka�е��ӳٶ��У����԰������²�����У�





1.����һ��ר�ŵ�Topic���ڴ洢�ӳ���Ϣ������"delayed-messages"������ʹ��Kafka�����й��߻�Kafka API���д�����





2.����Ϣ��key�������ӳ�ʱ���������ʹ�õ�ǰʱ��������ӳ�ʱ����Ϊkey�����磺"key":"message_body"������ʹ��Kafka API������Ϣ��"delayed-messages" Topic�С�





3.����һ�������߽��̣���������"delayed-messages" Topic�е���Ϣ������ʹ��Kafka APIʵ�������߽��̡�





4.�������߽����У������Ϣ��key�е�ʱ����Ƿ��Ѿ����ڡ�����ʹ�õ�ǰʱ�������Ϣ��key�е�ʱ������бȽϡ����ʱ����Ѿ����ڣ�����Ϣ���·��͵�Ŀ��Topic�У�����"target-messages"������ʹ��Kafka APIʵ����Ϣ�����·��͡�





5.���ʱ�����δ���ڣ�����Ϣ���·��͵�"delayed-messages" Topic�У�������һ���µ��ӳ�ʱ���������ʹ��Kafka APIʵ����Ϣ�����·��ͣ�������Ϣ��key�������µ��ӳ�ʱ�����





6.�ȴ�һ��ʱ����ظ�ִ�е�4�͵�5����ֱ����Ϣ��key�е�ʱ����Ѿ����ڡ�





ͨ�����ϲ��裬�Ϳ���ʵ��Kafka�е��ӳٶ��й��ܡ���Ҫע����ǣ������߽�����Ҫ���ڴ�"delayed-messages" Topic��������Ϣ���������Ϣ��key�е�ʱ����Ƿ��Ѿ����ڡ����Ը��ݾ����Ӧ�ó������ò�ͬ���ӳ�ʱ�䡣






![image-20230526211452328](https://java-tutorial.oss-cn-shanghai.aliyuncs.com/image-20230526211452328.png)





### �ġ��ӳ���Ϣʵ�ֵ���ȱ��






![image-20230526211506828](https://java-tutorial.oss-cn-shanghai.aliyuncs.com/image-20230526211506828.png)





Kafka��ʵ���ӳٶ��еķ������������ŵ㣺





1.�����ڷֲ�ʽϵͳ��ʵ���ӳٶ��й��ܣ����нϸߵĿ���չ�ԺͿɿ��ԡ�





2.ʵ�ּ򵥣�ֻ��Ҫʹ��Kafka API���ɣ�������������򹤾ߡ�





3.֧����Ϣ���������ͺ����ѣ�����������ܺ���������





4.�������ص����ӳ�ʱ���Ŀ��Topic�������ڲ�ͬ��Ӧ�ó�����





���ǣ�Kafka��ʵ���ӳٶ���Ҳ����һЩȱ�㣺





1.��Ҫ�����߽��̶��ڴ�"delayed-messages" Topic��������Ϣ����������߽���崻�����ֹͣ���������Ӱ���ӳٶ��еĹ��ܡ�





2.�����߽�����Ҫ����Ϣ�������·��ͺͼ�飬��Ҫ����һ������Դ��ʱ�䡣





3.�ӳ�ʱ�侫�����ޣ���Сֻ�ܴﵽ���뼶��





### �ġ��ܽ�





Kafka��һ������ǿ��ķֲ�ʽ��Ϣϵͳ������ʵ���ӳٶ��еĹ��ܡ�ͨ������Ϣ��key�������ӳ�ʱ�������������߽��̵Ķ������Ѻ����·��ͣ�����ʵ���ӳٶ��еĹ��ܡ�Kafka��ʵ���ӳٶ��еķ�������ʵ�ּ򵥡�����չ�Ըߡ����ܺõ��ŵ㣬��Ҳ����һЩȱ�㡣��ʵ��Ӧ���У���Ҫ���ݾ����Ӧ�ó���������ѡ����ʵ��ӳٶ���ʵ�ַ�����